{{ define "title" }}RepLog — Login Tokens{{ end }}

{{ define "content" }}
        <div id="login-tokens-section">
            <h2>Device Login Links</h2>
            <p><small>Generate a link your kid can bookmark or add to their iOS home screen for passwordless login.</small></p>

            {{ if .NewTokenURL }}
            <article class="callout-card">
                <p><strong>New login link created!</strong></p>
                <p>Copy this link and send it to the device. It will only be shown once in full.</p>
                <div class="flex-row--spaced">
                    <input type="text" value="{{ .NewTokenURL }}" readonly data-select-on-focus aria-label="Login URL" class="input-flex mb-0">
                    <button type="button" class="btn-inline" data-copy>Copy</button>
                </div>
                <p><small>Tip: On iOS Safari, open this link, then tap Share → Add to Home Screen for one-tap login.</small></p>
            </article>
            {{ end }}

            <form hx-post="/users/{{ .UserID }}/tokens" hx-target="#login-tokens-section" hx-swap="outerHTML">
                {{ if .CSRFToken }}<input type="hidden" name="csrf_token" value="{{ .CSRFToken }}">{{ end }}
                <div class="flex-row">
                    <input type="text" id="token-label" name="label" placeholder="e.g. iPad, iPhone" autocomplete="off" aria-label="Device Label" class="input-flex mb-0">
                    <button type="submit" class="btn-inline">Generate Link</button>
                </div>
            </form>

            {{ if .Tokens }}
            <div class="table-scroll">
            <table class="striped">
                <thead>
                    <tr>
                        <th scope="col">Label</th>
                        <th scope="col">Created</th>
                        <th scope="col">Status</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    {{ range .Tokens }}
                    <tr>
                        <td>{{ if .Label.Valid }}{{ .Label.String }}{{ else }}<small>—</small>{{ end }}</td>
                        <td><small>{{ .CreatedAt.Format "Jan 2, 2006" }}</small></td>
                        <td>
                            {{ if .IsExpired }}
                                <mark class="secondary">Expired</mark>
                            {{ else }}
                                <mark>Active</mark>
                            {{ end }}
                        </td>
                        <td>
                            <form method="POST" action="/users/{{ .UserID }}/tokens/{{ .ID }}/delete"
                                  hx-post="/users/{{ .UserID }}/tokens/{{ .ID }}/delete"
                                  hx-target="#login-tokens-section" hx-swap="outerHTML"
                                  hx-confirm="Revoke this login link? The device will need a new link to log in.">
                                <button type="submit" class="outline secondary">Revoke</button>
                            </form>
                        </td>
                    </tr>
                    {{ end }}
                </tbody>
            </table>
            </div>
            {{ else }}
            <p><small>No active login links.</small></p>
            {{ end }}
        </div>
{{ end }}
