{{ define "title" }}{{ appName }} — Home{{ end }}

{{ define "content" }}
<section>
    <h1>Welcome{{ if .User }}, {{ displayName .User }}{{ end }}</h1>

    {{ if .ShowPasskeySuggestion }}
    <div class="passkey-hint" id="passkey-suggestion">
        <span>Secure your account with a <a href="/setup/passkey">passkey</a> for passwordless sign-in.</span>
        <form method="POST" action="/setup/passkey/skip"
              hx-post="/setup/passkey/skip"
              hx-target="#passkey-suggestion"
              hx-swap="delete">
            {{ if $.CSRFToken }}<input type="hidden" name="csrf_token" value="{{ $.CSRFToken }}">{{ end }}
            <button type="submit" class="passkey-hint-dismiss" aria-label="Dismiss">&times;</button>
        </form>
    </div>
    {{ end }}

    {{ if or .User.IsCoach .User.IsAdmin }}
    <p>Track your training. Review your progress. Stay consistent.</p>

    {{ if .Stats }}
    <div class="stats-row">
        <article class="stat-card">
            <div class="stat-value">{{ .Stats.WeekSessions }}</div>
            <div class="stat-label">Sessions This Week</div>
        </article>
        <article class="stat-card">
            <div class="stat-value">{{ formatVolume .Stats.WeekVolume }}</div>
            <div class="stat-label">Volume This Week ({{ weightUnit .Prefs }})</div>
        </article>
        <article class="stat-card">
            <div class="stat-value">{{ .Stats.TrainedThisWeek }}/{{ .Stats.TotalAthletes }}</div>
            <div class="stat-label">Athletes Trained</div>
        </article>
        <article class="stat-card">
            <div class="stat-value">{{ .Stats.ConsecutiveWeeks }}w</div>
            <div class="stat-label">Week Streak</div>
        </article>
    </div>
    {{ end }}

    <div class="dashboard-grid">
        <a href="/athletes" class="card-link">
            <article>
                <h2>Athletes</h2>
                <p>Manage athlete profiles and tiers</p>
            </article>
        </a>
        <a href="/exercises" class="card-link">
            <article>
                <h2>Exercises</h2>
                <p>Browse and manage the exercise library</p>
            </article>
        </a>
        <a href="/reviews/pending" class="card-link">
            <article>
                <h2>Reviews</h2>
                <p>{{ if .ReviewStats }}{{ .ReviewStats.PendingCount }} workouts pending review{{ else }}Review athlete workouts{{ end }}</p>
            </article>
        </a>
        <a href="/users" class="card-link">
            <article>
                <h2>Users</h2>
                <p>Manage login accounts and roles</p>
            </article>
        </a>
    </div>

    {{ if .Athletes }}
    <section>
        <h2>Quick Start</h2>
        <p class="text-muted">Select an athlete to start logging workouts.</p>
        <div class="table-scroll">
        <table class="striped">
            <thead>
                <tr>
                    <th scope="col">Athlete</th>
                    <th scope="col">Tier</th>
                    <th scope="col">Assignments</th>
                    <th scope="col"></th>
                </tr>
            </thead>
            <tbody>
                {{ range .Athletes }}
                <tr>
                    <td><a href="/athletes/{{ .ID }}">{{ .Name }}</a></td>
                    <td>{{ if .Tier.Valid }}<span class="tier-badge" data-tier="{{ .Tier.String }}">{{ tierLabel .Tier.String }}</span>{{ else }}<span class="text-muted">—</span>{{ end }}</td>
                    <td>{{ .ActiveAssignments }}</td>
                    <td><a href="/athletes/{{ .ID }}/workouts/new" role="button" class="outline secondary">New Workout</a></td>
                </tr>
                {{ end }}
            </tbody>
        </table>
        </div>
    </section>
    {{ end }}

    {{ else }}
    {{/* Non-coach without linked athlete (linked non-coaches are redirected by handler) */}}
    <article class="empty-state">
        <p>Your account is not linked to an athlete profile yet.</p>
        <p>Ask your coach to link your account so you can start logging workouts.</p>
    </article>
    {{ end }}
</section>
{{ end }}
